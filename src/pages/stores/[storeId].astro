---
import Layout from '../../layouts/Layout.astro';
import { getStoreByStoreId } from '../../lib/api/stores';
import { getImageUrl } from '../../lib/utils/image';
import { formatDate } from '../../lib/utils/date';
import MaleIcon from '../../assets/icons/icon_male.svg?raw';
import FemaleIcon from '../../assets/icons/icon_female.svg?raw';
import BaseButton from '../../components/ui/buttons/BaseButton.astro';
import ButtonWrapper from '../../components/ui/buttons/ButtonWrapper.astro';
import VoiceCard from '../../components/voice/VoiceCard.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import PetTabs from '../../components/pets/PetTabs.astro';
import PetCard from '../../components/pets/PetCard.astro';
import SectionHeading from '../../components/ui/SectionHeading.astro';
import BannerSection from '../../components/sections/common/BannerSection.astro';
import ContactCTASection from '../../components/sections/common/ContactCTASection.astro';
import '../../styles/layout/pets-grid.scss';
import '../../components/pets/PetCard.scss';
import '../../styles/pages/pet-detail.scss';

export async function getStaticPaths() {
  try {
    const { getAllStores } = await import('../../lib/api/stores');
    const stores = await getAllStores();
    
    const paths = stores.map((store) => ({
      params: { 
        storeId: store.storeId
      }
    }));
    
    console.log('[getStaticPaths] ç”Ÿæˆã•ã‚Œã‚‹åº—èˆ—è©³ç´°ãƒšãƒ¼ã‚¸æ•°:', paths.length);
    return paths;
  } catch (error) {
    console.error('[getStaticPaths] åº—èˆ—è©³ç´°ãƒšãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼:', error);
    return [];
  }
}

const { storeId } = Astro.params;

console.log('=== åº—èˆ—è©³ç´°ãƒšãƒ¼ã‚¸é–‹å§‹ ===');
console.log('storeId:', storeId);

// åº—èˆ—è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const storeInfo = await getStoreByStoreId(storeId);

if (!storeInfo) {
  console.error(`Store not found: ${storeId}`);
  return Astro.redirect('/stores?error=not-found');
}

console.log('è¦‹ã¤ã‹ã£ãŸåº—èˆ—:', storeInfo.storeName);
console.log('åº—èˆ—ç”»åƒæ•°:', storeInfo.storeImages?.length || 0);
console.log('åº—èˆ—å‹•ç”»URL:', storeInfo.storeMovie);

// å¿…é ˆæƒ…å ±ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
if (!storeInfo.storeName) {
  console.warn('åº—èˆ—åãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
}
if (!storeInfo.storeAddress && !storeInfo.storePostCode) {
  console.warn('åº—èˆ—ã®ä½æ‰€æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
}

// ç”»åƒãƒ»å‹•ç”»URLã‚’æº–å‚™
const mediaItems = [];
const placeholderImage = '/images/ui/img_loading-pet-image-01.webp';

// ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¹ãƒ­ãƒƒãƒˆã®æº–å‚™ï¼ˆæœ€å¤§4ã¤ï¼šç”»åƒ3æš + å‹•ç”»1ã¤ï¼‰
const maxImages = 3;
const mediaSlots = [
  ...Array.from({ length: maxImages }, (_, i) => ({ 
    url: storeInfo.storeImages?.[i]?.url, 
    type: 'image', 
    label: `å†™çœŸ${i + 1}` 
  })),
  { url: storeInfo.storeMovie, type: 'video', label: 'å‹•ç”»' }
];

mediaSlots.forEach((slot, index) => {
  if (slot.url) {
    if (slot.type === 'image') {
      mediaItems.push({
        type: 'image',
        url: getImageUrl(slot.url, 800, 600),
        thumbnail: getImageUrl(slot.url, 150, 150),
        alt: `${storeInfo.storeName}ã®${slot.label}`
      });
    } else if (slot.type === 'video') {
      console.log('=== åº—èˆ—å‹•ç”»å‡¦ç†ãƒ‡ãƒãƒƒã‚° ===');
      console.log('åº—èˆ—å‹•ç”»ãƒ‡ãƒ¼ã‚¿å‹:', typeof slot.url);
      console.log('åº—èˆ—å‹•ç”»ãƒ‡ãƒ¼ã‚¿:', slot.url);
      
      // å‹•ç”»URLã®æ­£è¦åŒ–å‡¦ç†
      let videoUrl = null;
      
      if (!slot.url) {
        console.log('å‹•ç”»ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“');
      } else if (typeof slot.url === 'string') {
        // æ–‡å­—åˆ—ã®å ´åˆï¼ˆå¾“æ¥ã®Google Driveã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼‰
        videoUrl = slot.url;
        console.log('æ–‡å­—åˆ—URL:', videoUrl);
        
        // ç›¸å¯¾ãƒ‘ã‚¹ã®å ´åˆã¯çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
        if (!videoUrl.startsWith('http') && !videoUrl.startsWith('/')) {
          videoUrl = `/${videoUrl}`;
        }
      } else if (typeof slot.url === 'object' && slot.url?.url) {
        // MicroCMSãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆ
        videoUrl = slot.url.url;
        console.log('MicroCMSãƒ•ã‚¡ã‚¤ãƒ«URL:', videoUrl);
        console.log('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:', slot.url.fileSize);
      }
      
      console.log('æœ€çµ‚çš„ãªå‹•ç”»URL:', videoUrl);
      
      if (videoUrl) {
        // ãƒ†ã‚¹ãƒˆç”¨å‹•ç”»URLï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
        const testVideoUrl = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
        
        mediaItems.push({
          type: 'video',
          url: videoUrl,
          thumbnail: videoUrl, // å‹•ç”»URLã‚’ã‚µãƒ ãƒã‚¤ãƒ«ç”¨ã«ã‚‚ä½¿ç”¨
          alt: `${storeInfo.storeName}ã®${slot.label}`,
          testUrl: testVideoUrl // ãƒ‡ãƒãƒƒã‚°ç”¨
        });
      } else {
        console.log('æœ‰åŠ¹ãªå‹•ç”»URLãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ä½¿ç”¨');
        mediaItems.push({
          type: 'image',
          url: placeholderImage,
          thumbnail: placeholderImage,
          alt: `${storeInfo.storeName}ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å‹•ç”»`,
          isPlaceholder: true
        });
      }
    }
  } else {
    // ç©ºã®ã‚¹ãƒ­ãƒƒãƒˆã«ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒã‚’ä½¿ç”¨
    mediaItems.push({
      type: 'image',
      url: placeholderImage,
      thumbnail: placeholderImage,
      alt: `${storeInfo.storeName}ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒ${index + 1}`,
      isPlaceholder: true
    });
  }
});

console.log('ãƒ¡ãƒ‡ã‚£ã‚¢é …ç›®æ•°:', mediaItems.length);
console.log('ãƒ¡ãƒ‡ã‚£ã‚¢é …ç›®è©³ç´°:', mediaItems.map(item => ({ type: item.type, hasUrl: !!item.url, hasThumbnail: !!item.thumbnail })));

// åº—èˆ—ã®ãƒšãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
const { getAllLatestPets } = await import('../../lib/api/pets/queries');
try {
  // å…¨ãƒšãƒƒãƒˆã‚’å–å¾—ï¼ˆæ—¢ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ¸ˆã¿ï¼‰
  const allPets = await getAllLatestPets();
  
  // å½“è©²åº—èˆ—ã®ãƒšãƒƒãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«é †åºã‚’ç¶­æŒï¼‰
  const allStorePets = allPets.filter(pet => pet.storeName === storeInfo.storeName);
  
  // å…¨ã¦ã®åº—èˆ—ãƒšãƒƒãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«å¤‰æ›´
  var storeDogs = allStorePets.filter(pet => pet.animalType === 'dog');
  var storeCats = allStorePets.filter(pet => pet.animalType === 'cat');
  var initialPets = allStorePets; // å…¨ã¦ã®åº—èˆ—ãƒšãƒƒãƒˆã‚’è¡¨ç¤º
  
} catch (error) {
  console.error('ãƒšãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
  var initialPets = [];
  var storeDogs = [];
  var storeCats = [];
}

console.log('åº—èˆ—ãƒšãƒƒãƒˆæ•° - åˆæœŸè¡¨ç¤º:', initialPets?.length || 0, 'çŠ¬:', storeDogs?.length || 0, 'çŒ«:', storeCats?.length || 0);

// ãŠå®¢æ§˜ã®å£°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆæœ€å¤§2ä»¶ã‚’è¡¨ç¤ºï¼‰
let displayVoices = [];
try {
  const { getVoices } = await import('../../lib/api/voice');
  const allVoices = await getVoices(3); // ä½™è£•ã‚’æŒãŸã›ã¦3ä»¶å–å¾—
  displayVoices = allVoices.slice(0, 2);
  console.log('ãŠå®¢æ§˜ã®å£°ãƒ‡ãƒ¼ã‚¿:', displayVoices.length, 'ä»¶å–å¾—');
} catch (error) {
  console.error('ãŠå®¢æ§˜ã®å£°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
  displayVoices = [];
}

// SEOç”¨ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
const storeTitle = `${storeInfo.storeName}`;
const storeDescription = `ã‚«ãƒˆãƒ¬ã‚¢${storeInfo.storeName}ã®åº—èˆ—æƒ…å ±ã€‚${storeInfo.storeAddress}ã«ã”ã–ã„ã¾ã™ã€‚å–¶æ¥­æ™‚é–“ï¼š${storeInfo.businessHours?.replace(/\n/g, ' ')}ã€‚å­çŠ¬ãƒ»å­çŒ«ã¨ã®å‡ºä¼šã„ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚`;

// ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿
const breadcrumbItems = [
  { label: 'ãƒ›ãƒ¼ãƒ ', href: '/' },
  { label: 'åº—èˆ—ä¸€è¦§', href: '/stores' },
  { label: `${storeInfo.storeName}` }
];
---

<Layout title={storeTitle} description={storeDescription}>
  <main>
    <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
    <div class="breadcrumb-container">
      <div class="container">
        <Breadcrumb items={breadcrumbItems} />
      </div>
    </div>
    
    <section class="pet-detail store-detail">
      <div class="container">
        <div class="pet-detail__content">
          <!-- åº—èˆ—å -->
          <div class="pet-detail__header">
            <h1 class="pet-detail__title">
              Cattleya {storeInfo.storeName}
            </h1>
          </div>

          <div class="pet-detail__body">
            <!-- ã‚«ãƒ«ãƒ¼ã‚»ãƒ« -->
            <div class="pet-detail__carousel">
              <div class="carousel">
                <div class="carousel__main">
                  <button class="carousel__nav carousel__nav--prev" id="prevBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                  </button>
                  
                  <div class="carousel__container" id="carousel-container">
                    {mediaItems.map((item, index) => (
                      <div 
                        class={`carousel__slide ${index === 0 ? 'carousel__slide--active' : ''}`}
                        data-index={index}
                      >
                        {item.type === 'image' ? (
                          <img 
                            src={item.url}
                            alt={item.alt}
                            class="carousel__image carousel__image--clickable"
                            loading={index === 0 ? 'eager' : 'lazy'}
                            onload="this.style.opacity='1'"
                            style="opacity: 0; transition: opacity 0.3s ease; cursor: pointer;"
                          />
                        ) : (
                          <div class="carousel__video-container">
                            <video
                              class="carousel__video"
                              data-video-src={item.url}
                              preload="metadata"
                              muted
                              playsInline
                            ></video>
                            <div class="carousel__video-play-btn">
                              <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                                <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                              </svg>
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>

                  <button class="carousel__nav carousel__nav--next" id="nextBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </button>
                </div>

                <!-- ã‚µãƒ ãƒã‚¤ãƒ« -->
                <div class="carousel__thumbnails">
                  {mediaItems.map((item, index) => (
                    <button 
                      class={`carousel__thumbnail ${index === 0 ? 'carousel__thumbnail--active' : ''}`}
                      data-index={index}
                    >
                      {item.type === 'image' ? (
                        <img 
                          src={item.thumbnail}
                          alt={item.alt}
                          class="carousel__thumbnail-image"
                        />
                      ) : (
                        <div class="carousel__thumbnail-video">
                          <video
                            class="carousel__thumbnail-video-element"
                            data-video-src={item.url}
                            preload="metadata"
                            muted
                            playsInline
                          ></video>
                          <div class="carousel__thumbnail-play-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                              <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                            </svg>
                          </div>
                        </div>
                      )}
                    </button>
                  ))}
                </div>
              </div>
            </div>

            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆåº—èˆ—æƒ…å ±ï¼‰ -->
            <div class="pet-detail__sidebar">
              <!-- ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆlgä»¥ä¸Šã§è¡¨ç¤ºï¼‰ -->
              <div class="pet-detail__sidebar-title">
                <h1 class="pet-detail__title">
                  Cattleya {storeInfo.storeName}
                </h1>
              </div>

              <!-- åº—èˆ—æƒ…å ± -->
              <div class="pet-detail__info">
                <div class="pet-info store-info">
                  <div class="pet-info__item">
                    <dt class="pet-info__label">ä½æ‰€</dt>
                    <dd class="pet-info__value">
                      {storeInfo.storePostCode && `ã€’${storeInfo.storePostCode}`}
                      {storeInfo.storeAddress && (
                        <div>{storeInfo.storeAddress}</div>
                      )}
                      {storeInfo.trafficInformation && (
                        <div class="traffic-info">{storeInfo.trafficInformation}</div>
                      )}
                    </dd>
                  </div>
                  
                  {storeInfo.businessHours && (
                    <div class="pet-info__item">
                      <dt class="pet-info__label">å–¶æ¥­æ™‚é–“</dt>
                      <dd class="pet-info__value business-hours">{storeInfo.businessHours}</dd>
                    </div>
                  )}
                  
                  {storeInfo.storePhoneNumber && (
                    <div class="pet-info__item">
                      <dt class="pet-info__label">é›»è©±ç•ªå·</dt>
                      <dd class="pet-info__value">
                        <a href={`tel:${storeInfo.storePhoneNumber.replace(/[^0-9]/g, '')}`} class="phone-link">
                          {storeInfo.storePhoneNumber}
                        </a>
                      </dd>
                    </div>
                  )}
                  
                  {storeInfo.storeLine && (
                    <div class="pet-info__item pet-info__item--line">
                      <dt class="pet-info__label">åº—èˆ—LINE</dt>
                      <dd class="pet-info__value">
                        <a 
                          href={`https://lin.ee/${storeInfo.storeLine}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="line-button"
                        >
                          <span class="line-button__line"></span>
                          <span class="line-button__text">{storeInfo.storeName}LINE</span>
                          <span class="line-button__icon">
                            <img src="/icons/icon_line-01.svg" alt="LINE" />
                          </span>
                        </a>
                      </dd>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>

          <!-- Googleãƒãƒƒãƒ— -->
          {storeInfo.storeMapHtml && (
            <div class="pet-detail__map">
              <div class="map-container" set:html={storeInfo.storeMapHtml}></div>
            </div>
          )}
        </div>
      </div>
    </section>

    {initialPets.length === 0 && (
      <section class="no-pets-section">
        <div class="container">
          <div class="no-pets-message">
            <p>ã“ã®åº—èˆ—ã«ã¯ç¾åœ¨ã€è¡¨ç¤ºã§ãã‚‹ãƒšãƒƒãƒˆãŒã„ã¾ã›ã‚“ã€‚</p>
            <p>æœ€æ–°æƒ…å ±ã«ã¤ã„ã¦ã¯ç›´æ¥åº—èˆ—ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
          </div>
        </div>
      </section>
    )}

    <!-- åº—èˆ—ã®Dogs&Catsã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    {initialPets.length > 0 && (
      <section class="pets-section">
        <div class="container">
          <SectionHeading 
            subtitle="Dogs and Cats"
            title="Dogs&Cats"
            subtitleClass="text-disabled"
            titleClass="text-primary"
          />
          <PetTabs activeTab="all" />
          <div class="pets-count" id="pets-count">
            <span class="pets-count__number">{initialPets.length}</span><span class="pets-count__unit">ä»¶</span>
          </div>
          <div class="pets-grid" 
            data-all-pets={JSON.stringify(initialPets)}
            data-dogs={JSON.stringify(storeDogs)}
            data-cats={JSON.stringify(storeCats)}>
            {initialPets.map((pet) => (
              <PetCard pet={pet} />
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- é–¢é€£ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="related-content-section">
      <div class="container">
        <!-- ãƒ¯ãƒ³ã¡ã‚ƒã‚“ãƒ»ãƒã‚³ã¡ã‚ƒã‚“ã«ä¼šã„ãŸã„ãƒœãƒƒã‚¯ã‚¹ -->
        <div class="content-box">
          <h2 class="content-box__title">ãƒ¯ãƒ³ã¡ã‚ƒã‚“ãƒ»ãƒã‚³ã¡ã‚ƒã‚“ã«<br class="mobile-break">ä¼šã„ãŸã„</h2>
          <div class="content-box__buttons">
            <a href="/flow" class="bg-button bg-button--flow">
              <div class="bg-button__overlay">
                <span class="bg-button__text">ãŠè¿ãˆã¾ã§ã®æµã‚Œ</span>
              </div>
            </a>
            <a href="/reserve" class="bg-button bg-button--reserve">
              <div class="bg-button__overlay">
                <span class="bg-button__text">æ¥åº—äºˆç´„ã‚’ã™ã‚‹</span>
              </div>
            </a>
          </div>
        </div>

        <!-- ãŠå®¢æ§˜ã®å£°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="content-box voice-content-box">
          <h2 class="content-box__title">ãŠå®¢æ§˜ã®å£°</h2>
          <div class="voice-grid">
            {displayVoices.map((voice, index) => (
              <div class={`voice-card-wrapper ${index >= 1 ? 'voice-card--sm-only' : ''}`}>
                <VoiceCard
                  petName={voice.petName}
                  petGender={voice.petGender}
                  petThumbnail={voice.petThumbnail}
                  ownerName={voice.ownerName}
                  animalType={voice.animalType}
                  store={voice.store}
                  voiceContent={voice.voiceContent}
                  class="voice-card--compact"
                />
              </div>
            ))}
          </div>
          <ButtonWrapper>
            <BaseButton href="/voice" text="ã‚‚ã£ã¨ã¿ã‚‹" variant="short" />
          </ButtonWrapper>
        </div>

        <!-- ã‚«ãƒˆãƒ¬ã‚¢ã®å®‰å¿ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="content-box relief-content-box">
          <h2 class="content-box__title">ã‚«ãƒˆãƒ¬ã‚¢ã®å®‰å¿ƒ</h2>
          <div class="relief-section-inner">
            <div class="relief-img-wrap">
              <img src="/images/content/img_relief-main-01.webp" alt="ã‚«ãƒˆãƒ¬ã‚¢ã®å®‰å¿ƒ" class="relief-img" loading="lazy" />
            </div>
            
            <div class="relief-content">
              <p class="relief-desc">ã‚«ãƒˆãƒ¬ã‚¢ã§ã¯ã€å°‚é–€ç£åŒ»å¸«ã«ã‚ˆã‚‹å¾¹åº•ã—ãŸå¥åº·ç®¡ç†ã‚„ã€ä¸‡ãŒä¸€ã®äº‹æ…‹ã«å‚™ãˆãŸä¿è¨¼ã€ãã—ã¦ãŠè¿ãˆå¾Œã‚‚ç¶šãã‚µãƒãƒ¼ãƒˆã‚’é€šã˜ã¦ã€ãƒšãƒƒãƒˆã¨ãŠå®¢æ§˜ãŒå®‰å¿ƒã—ã¦éã”ã›ã‚‹ç’°å¢ƒã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚<br>å¥åº·çŠ¶æ…‹ã®è©³ç´°ãªæƒ…å ±æä¾›ã‚„ã€æ¸…æ½”ãªç’°å¢ƒã§ã®é£¼è‚²ã‚‚å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚<br><br>ãƒšãƒƒãƒˆã¨å®¶æ—ãŒä¸€ç”Ÿæ¶¯å®‰å¿ƒã—ã¦ä¸€ç·’ã«éã”ã›ã‚‹ã‚ˆã†ã€å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã§ã‚µãƒãƒ¼ãƒˆã‚’ç¶šã‘ã¦ã„ã¾ã™ã€‚</p>
              <ButtonWrapper>
                <BaseButton href="/relief" text="è©³ã—ãã¿ã‚‹" variant="short" />
              </ButtonWrapper>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ãƒãƒŠãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <BannerSection />

    <!-- ãŠå•ã„åˆã‚ã›CTAã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <ContactCTASection />
  </main>

  <!-- JSON-LDæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "PetStore",
    "name": `Cattleya ${storeInfo.storeName}`,
    "url": Astro.url.toString(),
    "logo": "https://cattleya-pets.com/images/logo.png",
    "image": "https://cattleya-pets.com/og-image.png",
    "description": storeDescription,
    "address": {
      "@type": "PostalAddress",
      "postalCode": storeInfo.storePostCode || '',
      "addressRegion": "æ±äº¬éƒ½",
      "addressLocality": storeInfo.storeAddress ? storeInfo.storeAddress.split('\n')[0] : '',
      "streetAddress": storeInfo.storeAddress ? storeInfo.storeAddress.replace(/\n/g, ' ') : ''
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": storeInfo.storeName === 'æ–°å®¿åº—' ? 35.6928 : storeInfo.storeName === 'æ¸‹è°·åº—' ? 35.6611 : 35.7305,
      "longitude": storeInfo.storeName === 'æ–°å®¿åº—' ? 139.7024 : storeInfo.storeName === 'æ¸‹è°·åº—' ? 139.6957 : 139.7153
    },
    "telephone": storeInfo.storePhoneNumber || '',
    "openingHours": storeInfo.businessHours ? storeInfo.businessHours.replace(/\n/g, ' ') : '',
    "priceRange": "$$"
  })}>
  </script>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="media-modal" class="media-modal">
    <div class="media-modal__overlay"></div>
    <div class="media-modal__content">
      <button class="media-modal__close" id="modal-close">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      
      <button class="media-modal__nav media-modal__nav--prev" id="modal-prev">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      
      <button class="media-modal__nav media-modal__nav--next" id="modal-next">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      
      <div class="media-modal__media" id="modal-media">
        <!-- ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
      </div>
    </div>
  </div>

</Layout>

<script define:vars={{ mediaItemsCount: mediaItems.length, mediaItems: mediaItems }}>

  // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…ã¤
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Store page initialized with HTML5 video support');
    
    // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ï¼ˆAstroã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ï¼‰
    const mediaItemsData = mediaItems;
    const mediaItemsCount = mediaItems.length;
    
    console.log('ğŸ¯ Found media items:', mediaItemsData.length);
    console.log('ğŸ¯ Media items data:', mediaItemsData);
    
    let currentSlide = 0;
    let currentModalSlide = 0;
    
    const slides = document.querySelectorAll('.carousel__slide');
    const thumbnails = document.querySelectorAll('.carousel__thumbnail');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    console.log(`ğŸ¯ Found ${slides.length} slides, ${thumbnails.length} thumbnails`);
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ 
    const modal = document.getElementById('media-modal');
    const modalMedia = document.getElementById('modal-media');
    const modalClose = document.getElementById('modal-close');
    const modalOverlay = modal?.querySelector('.media-modal__overlay');
    const modalPrev = document.getElementById('modal-prev');
    const modalNext = document.getElementById('modal-next');

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.toggle('carousel__slide--active', i === index);
        
        // HTML5 videoè¦ç´ ã®åˆ¶å¾¡
        const video = slide.querySelector('.carousel__video');
        const playBtn = slide.querySelector('.carousel__video-play-btn');
        
        if (video && video.dataset.videoSrc) {
          if (i === index) {
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¹ãƒ©ã‚¤ãƒ‰ã§ã¯å‹•ç”»URLã‚’è¨­å®šã€å†ç”Ÿãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            const videoUrl = video.dataset.videoSrc;
            console.log('ğŸ¬ Loading main carousel video with URL:', videoUrl);
            video.src = videoUrl;
            
            // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¾Œã«æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
            video.addEventListener('loadedmetadata', () => {
              console.log('ğŸ¬ Main carousel video metadata loaded');
              video.currentTime = 0.5; // 0.5ç§’åœ°ç‚¹ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
            });
            
            video.addEventListener('seeked', () => {
              console.log('ğŸ¬ Main carousel video seeked to first frame');
              video.pause(); // æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§ä¸€æ™‚åœæ­¢
            });
            
            if (playBtn) playBtn.style.display = 'flex';
          } else {
            // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¹ãƒ©ã‚¤ãƒ‰ã®å‹•ç”»ã‚’ãƒªã‚»ãƒƒãƒˆ
            video.src = '';
            video.pause();
            if (playBtn) playBtn.style.display = 'flex';
          }
        }
      });

      // ã‚µãƒ ãƒã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆ
      thumbnails.forEach((thumb, i) => {
        thumb.classList.toggle('carousel__thumbnail--active', i === index);
      });

      currentSlide = index;
    }

    function nextSlide() {
      const next = (currentSlide + 1) % mediaItemsCount;
      showSlide(next);
    }

    function prevSlide() {
      const prev = (currentSlide - 1 + mediaItemsCount) % mediaItemsCount;
      showSlide(prev);
    }

    // ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    if (prevBtn) {
      prevBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('Prev button clicked');
        prevSlide();
      });
    }
    
    if (nextBtn) {
      nextBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('Next button clicked');
        nextSlide();
      });
    }

    // ã‚µãƒ ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯
    thumbnails.forEach((thumb, index) => {
      thumb.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('Thumbnail clicked:', index);
        showSlide(index);
      });
    });

    // ãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½
    function openModal(mediaItem, slideIndex = currentSlide) {
      console.log('Opening modal with media:', mediaItem);
      console.log('ğŸ¯ Modal slide index:', slideIndex);
      if (!modal || !modalMedia) return;
      
      currentModalSlide = slideIndex;
      console.log('ğŸ¯ Updated currentModalSlide to:', currentModalSlide);
      updateModalNavButtons();
      
      modalMedia.innerHTML = '';
      
      if (mediaItem.type === 'image') {
        const img = document.createElement('img');
        img.src = mediaItem.url;
        img.alt = mediaItem.alt;
        img.className = 'media-modal__image store-modal-image'; // åº—èˆ—ç”¨ã®è¿½åŠ ã‚¯ãƒ©ã‚¹
        // åº—èˆ—è©³ç´°ãƒšãƒ¼ã‚¸å°‚ç”¨ï¼šæ¨ª4:ç¸¦3ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç›´æ¥é©ç”¨
        img.style.aspectRatio = '4 / 3';
        img.style.height = 'auto';
        img.style.objectFit = 'cover';
        img.style.borderRadius = '8px';
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®å¼·åˆ¶ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
        function applyResponsiveStyles() {
          const screenWidth = window.innerWidth;
          if (screenWidth >= 1280) { // xl
            img.style.width = 'min(90vw, 85vh)';
            img.style.height = 'auto';
            img.style.maxWidth = '90vw';
            img.style.maxHeight = '90vh';
          } else if (screenWidth >= 1024) { // lg
            img.style.width = 'min(85vw, 80vh)';
            img.style.height = 'auto';
            img.style.maxWidth = '85vw';
            img.style.maxHeight = '85vh';
          } else if (screenWidth >= 768) { // md
            img.style.width = 'min(85vw, 75vh)';
            img.style.height = 'auto';
            img.style.maxWidth = '85vw';
            img.style.maxHeight = '85vh';
          } else if (screenWidth >= 640) { // sm
            img.style.width = 'min(85vw, 63.75vh)';
            img.style.height = 'auto';
            img.style.maxWidth = '85vw';
            img.style.maxHeight = '85vh';
          } else {
            img.style.width = 'min(90vw, 67.5vh)';
            img.style.height = 'auto';
            img.style.maxWidth = '90vw';
            img.style.maxHeight = '90vh';
          }
        }
        
        applyResponsiveStyles();
        window.addEventListener('resize', applyResponsiveStyles);
        // ç”»åƒè¦ç´ ã«ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›´æ¥è¨­å®š
        img.addEventListener('touchstart', (e) => {
          console.log('ğŸ¯ Image touchstart detected');
          modalTouchStartX = e.touches[0].clientX;
          console.log('ğŸ¯ Touch start X:', modalTouchStartX);
          e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²ã
          e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        });

        img.addEventListener('touchend', (e) => {
          console.log('ğŸ¯ Image touchend detected');
          modalTouchEndX = e.changedTouches[0].clientX;
          console.log('ğŸ¯ Touch end X:', modalTouchEndX);
          console.log('ğŸ¯ Swipe distance:', modalTouchEndX - modalTouchStartX);
          handleModalSwipe();
          e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²ã
          e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        });

        img.addEventListener('touchmove', (e) => {
          console.log('ğŸ¯ Image touchmove detected');
          e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²ã
          e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        });
        
        console.log('ğŸ–¼ï¸ Store modal image created with class:', img.className);
        modalMedia.appendChild(img);
      } else if (mediaItem.type === 'video') {
        const video = document.createElement('video');
        video.src = mediaItem.url;
        video.className = 'media-modal__video store-modal-video'; // åº—èˆ—ç”¨ã®è¿½åŠ ã‚¯ãƒ©ã‚¹
        video.controls = true;
        video.preload = 'metadata';
        video.playsInline = true;
        video.muted = false; // ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ã¯éŸ³å£°ã‚ã‚Šã§å†ç”Ÿ
        // åº—èˆ—è©³ç´°ãƒšãƒ¼ã‚¸å°‚ç”¨ï¼šæ¨ª4:ç¸¦3ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç›´æ¥é©ç”¨
        video.style.aspectRatio = '4 / 3';
        video.style.height = 'auto';
        video.style.objectFit = 'cover';
        video.style.borderRadius = '8px';
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®å¼·åˆ¶ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
        function applyVideoResponsiveStyles() {
          const screenWidth = window.innerWidth;
          if (screenWidth >= 1280) { // xl
            video.style.width = 'min(90vw, 85vh)';
            video.style.height = 'auto';
            video.style.maxWidth = '90vw';
            video.style.maxHeight = '90vh';
          } else if (screenWidth >= 1024) { // lg
            video.style.width = 'min(85vw, 80vh)';
            video.style.height = 'auto';
            video.style.maxWidth = '85vw';
            video.style.maxHeight = '85vh';
          } else if (screenWidth >= 768) { // md
            video.style.width = 'min(85vw, 75vh)';
            video.style.height = 'auto';
            video.style.maxWidth = '85vw';
            video.style.maxHeight = '85vh';
          } else if (screenWidth >= 640) { // sm
            video.style.width = 'min(85vw, 63.75vh)';
            video.style.height = 'auto';
            video.style.maxWidth = '85vw';
            video.style.maxHeight = '85vh';
          } else {
            video.style.width = 'min(90vw, 67.5vh)';
            video.style.height = 'auto';
            video.style.maxWidth = '90vw';
            video.style.maxHeight = '90vh';
          }
        }
        
        applyVideoResponsiveStyles();
        window.addEventListener('resize', applyVideoResponsiveStyles);
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã§å‹•ç”»ã‚’è‡ªå‹•å†ç”Ÿé–‹å§‹
        video.play().then(() => {
          console.log('ğŸ¬ Modal video autoplay started');
        }).catch((error) => {
          console.log('ğŸ¬ Modal video autoplay failed:', error);
        });
        
        // å‹•ç”»è¦ç´ ã«ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›´æ¥è¨­å®š
        video.addEventListener('touchstart', (e) => {
          console.log('ğŸ¯ Video touchstart detected');
          modalTouchStartX = e.touches[0].clientX;
          console.log('ğŸ¯ Touch start X:', modalTouchStartX);
          e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²ã
          e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        });

        video.addEventListener('touchend', (e) => {
          console.log('ğŸ¯ Video touchend detected');
          modalTouchEndX = e.changedTouches[0].clientX;
          console.log('ğŸ¯ Touch end X:', modalTouchEndX);
          console.log('ğŸ¯ Swipe distance:', modalTouchEndX - modalTouchStartX);
          handleModalSwipe();
          e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²ã
          e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        });

        video.addEventListener('touchmove', (e) => {
          console.log('ğŸ¯ Video touchmove detected');
          e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²ã
          e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        });
        
        console.log('ğŸ¬ Store modal video created with class:', video.className);
        modalMedia.appendChild(video);
      }
      
      modal.classList.add('media-modal--active');
      document.body.style.overflow = 'hidden';
      console.log('Modal opened');
    }

    function closeModal() {
      if (!modal) return;
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®å‹•ç”»ã‚’åœæ­¢
      const modalVideo = modalMedia?.querySelector('video');
      if (modalVideo) {
        modalVideo.pause();
        modalVideo.currentTime = 0;
        console.log('ğŸ¬ Modal video stopped');
      }
      
      modal.classList.remove('media-modal--active');
      document.body.style.overflow = '';
      if (modalMedia) modalMedia.innerHTML = '';
      console.log('Modal closed');
    }

    function updateModalNavButtons() {
      // å¾ªç’°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚å¸¸ã«æœ‰åŠ¹ã«ã™ã‚‹
      if (modalPrev) {
        modalPrev.disabled = false;
        modalPrev.style.opacity = '1';
      }
      if (modalNext) {
        modalNext.disabled = false;
        modalNext.style.opacity = '1';
      }
    }

    function showModalSlide(index) {
      if (index >= 0 && index < mediaItemsData.length) {
        const mediaItem = mediaItemsData[index];
        openModal(mediaItem, index);
      }
    }

    function nextModalSlide() {
      console.log('ğŸ¯ nextModalSlide called, current:', currentModalSlide, 'max:', mediaItemsCount - 1);
      const nextIndex = (currentModalSlide + 1) % mediaItemsCount;
      showModalSlide(nextIndex);
    }

    function prevModalSlide() {
      console.log('ğŸ¯ prevModalSlide called, current:', currentModalSlide);
      const prevIndex = (currentModalSlide - 1 + mediaItemsCount) % mediaItemsCount;
      showModalSlide(prevIndex);
    }

    // ãƒ¡ã‚¤ãƒ³ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    slides.forEach((slide, index) => {
      slide.addEventListener('click', (e) => {
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã¯ç„¡è¦–
        if (e.target.closest('.carousel__nav')) {
          console.log('Navigation button clicked, ignoring');
          return;
        }
        
        console.log('ğŸ¯ Slide clicked, current slide index:', currentSlide);
        // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒ©ã‚¤ãƒ‰ã«å¯¾å¿œã™ã‚‹ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—
        const currentMedia = mediaItemsData[currentSlide];
        if (currentMedia) {
          console.log('ğŸ¯ Opening modal for media:', currentMedia.type, currentMedia.url);
          openModal(currentMedia, currentSlide);
        }
      });
    });

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    if (modalClose) modalClose.addEventListener('click', closeModal);
    if (modalOverlay) modalOverlay.addEventListener('click', closeModal);
    if (modalPrev) modalPrev.addEventListener('click', prevModalSlide);
    if (modalNext) modalNext.addEventListener('click', nextModalSlide);

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
    document.addEventListener('keydown', (e) => {
      if (modal && modal.classList.contains('media-modal--active')) {
        if (e.key === 'Escape') {
          closeModal();
        } else if (e.key === 'ArrowLeft') {
          prevModalSlide();
        } else if (e.key === 'ArrowRight') {
          nextModalSlide();
        }
      } else {
        if (e.key === 'ArrowLeft') prevSlide();
        if (e.key === 'ArrowRight') nextSlide();
      }
    });

    // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§ã®ã‚¿ãƒƒãƒã‚¹ãƒ¯ã‚¤ãƒ—ã‚µãƒãƒ¼ãƒˆï¼ˆãƒšãƒƒãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¨åŒã˜å®Ÿè£…ï¼‰
    let modalTouchStartX = 0;
    let modalTouchEndX = 0;
    const minSwipeDistance = 50;

    function handleModalSwipe() {
      const swipeDistance = modalTouchEndX - modalTouchStartX;
      console.log('ğŸ¯ Swipe distance calculated:', swipeDistance);
      console.log('ğŸ¯ Min swipe distance:', minSwipeDistance);
      console.log('ğŸ¯ Swipe detected:', Math.abs(swipeDistance) > minSwipeDistance);
      
      if (Math.abs(swipeDistance) > minSwipeDistance) {
        if (swipeDistance > 0) {
          console.log('ğŸ¯ Right swipe - going to previous slide');
          prevModalSlide();
        } else {
          console.log('ğŸ¯ Left swipe - going to next slide');
          nextModalSlide();
        }
      } else {
        console.log('ğŸ¯ Swipe distance too small, ignoring');
      }
    }

    // é‡è¤‡ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã€ç”»åƒãƒ»å‹•ç”»è¦ç´ ã«ç›´æ¥è¨­å®šã—ãŸã‚‚ã®ã®ã¿ä½¿ç”¨

    // ã‚¿ãƒƒãƒã‚¹ãƒ¯ã‚¤ãƒ—ã‚µãƒãƒ¼ãƒˆ
    let touchStartX = 0;
    let touchEndX = 0;
    
    const carouselContainer = document.getElementById('carousel-container');
    if (carouselContainer) {
      carouselContainer.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      });
      
      carouselContainer.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        const swipeThreshold = 50;
        const swipeDistance = touchStartX - touchEndX;
        
        if (Math.abs(swipeDistance) > swipeThreshold) {
          if (swipeDistance > 0) {
            nextSlide();
          } else {
            prevSlide();
          }
        }
      });
    }

    // Googleãƒãƒƒãƒ—èª¿æ•´
    function adjustMapSize() {
      const mapContainer = document.querySelector('.map-container');
      if (mapContainer) {
        const iframe = mapContainer.querySelector('iframe');
        if (iframe) {
          iframe.style.width = '100%';
          iframe.style.height = '360px';
          iframe.setAttribute('width', '100%');
          iframe.setAttribute('height', '360');
        }
      }
    }
    
    setTimeout(adjustMapSize, 100);
    setTimeout(adjustMapSize, 500);
    setTimeout(adjustMapSize, 1000);

    // ã‚µãƒ ãƒã‚¤ãƒ«å‹•ç”»ã®æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤ºï¼ˆãƒšãƒƒãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¨åŒã˜å®Ÿè£…ï¼‰
    function loadVideoThumbnails() {
      const thumbnailVideos = document.querySelectorAll('.carousel__thumbnail-video-element[data-video-src]');
      console.log('ğŸ¬ Found thumbnail videos:', thumbnailVideos.length);
      
      thumbnailVideos.forEach((video, index) => {
        const videoUrl = video.dataset.videoSrc;
        if (videoUrl) {
          console.log(`ğŸ¬ Loading thumbnail for video ${index}:`, videoUrl);
          
          // å‹•ç”»ã®srcã‚’è¨­å®š
          video.src = videoUrl;
          
          // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰é©åˆ‡ãªãƒ•ãƒ¬ãƒ¼ãƒ ã«ç§»å‹•
          video.addEventListener('loadedmetadata', () => {
            console.log(`ğŸ¬ Video ${index} metadata loaded, duration: ${video.duration}s`);
            // å‹•ç”»ã®é•·ã•ã«å¿œã˜ã¦é©åˆ‡ãªä½ç½®ã‚’é¸æŠï¼ˆæœ€åˆã®10%ã‹1ç§’ã®ã„ãšã‚Œã‹çŸ­ã„æ–¹ï¼‰
            const seekTime = Math.min(video.duration * 0.1, 1.0);
            video.currentTime = seekTime;
            console.log(`ğŸ¬ Seeking to ${seekTime}s`);
          });
          
          // ãƒ•ãƒ¬ãƒ¼ãƒ ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ä¸€æ™‚åœæ­¢
          video.addEventListener('seeked', () => {
            console.log(`ğŸ¬ Video ${index} seeked to first frame`);
            video.pause();
            // èƒŒæ™¯è‰²ã‚’ã‚¯ãƒªã‚¢ã—ã¦å‹•ç”»ã‚’è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
            video.style.backgroundColor = 'transparent';
          });
          
          // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
          video.addEventListener('error', (e) => {
            console.error(`ğŸ¬ Error loading thumbnail video ${index}:`, e);
          });
        }
      });
    }

    // åˆæœŸè¡¨ç¤ºï¼ˆãƒšãƒƒãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¨åŒã˜é †åºï¼‰
    showSlide(0);
    
    // ã‚µãƒ ãƒã‚¤ãƒ«å‹•ç”»ã‚’åˆæœŸåŒ–
    setTimeout(loadVideoThumbnails, 100);
    
    console.log('âœ… All event listeners set up with HTML5 video support');

    // ãƒšãƒƒãƒˆã‚¿ãƒ–æ©Ÿèƒ½ï¼ˆsearchãƒšãƒ¼ã‚¸ã¨åŒã˜ï¼‰
    const tabButtons = document.querySelectorAll('.pet-tabs__item');
    const petsGrid = document.querySelector('.pets-grid');
    const allStorePets = JSON.parse(petsGrid?.dataset.allPets || '[]');
    const storeDogs = JSON.parse(petsGrid?.dataset.dogs || '[]');
    const storeCats = JSON.parse(petsGrid?.dataset.cats || '[]');

    // ãƒšãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–¢æ•°
    function generatePetCard(pet) {
      // getImageUrlã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç›´æ¥å®Ÿè£…
      const imageUrl = pet.imageUrl01 ? `${pet.imageUrl01}?w=600&h=600&fit=crop` : '/images/ui/img_loading-pet-image-01.webp';
      const breedTypeEn = (pet.breedTypeEn || '').toLowerCase();
      const genderIcon = pet.gender === 'ç”·ã®å­' 
        ? '<span class="pet-card__gender male"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 0V5H14V1.733L8.871 6.817C9.201 7.297 9.47167 7.80367 9.683 8.337C9.89433 8.87033 10 9.42467 10 10C10 11.394 9.51533 12.576 8.546 13.546C7.57667 14.516 6.39533 15.0007 5.002 15C3.60867 14.9993 2.42667 14.5147 1.456 13.546C0.485333 12.5773 0 11.396 0 10.002C0 8.608 0.485 7.426 1.455 6.456C2.425 5.486 3.60667 5.00067 5 5C5.576 5 6.12733 5.105 6.654 5.315C7.18067 5.52433 7.682 5.79567 8.158 6.129L13.287 1H10V0H15ZM4.997 6C3.89167 6 2.949 6.39067 2.169 7.172C1.38967 7.954 1 8.89767 1 10.003C1 11.109 1.39067 12.0517 2.172 12.831C2.954 13.6103 3.89767 14 5.003 14C6.109 14 7.05167 13.6093 7.831 12.828C8.61033 12.046 9 11.1023 9 9.997C9 8.89167 8.60933 7.949 7.828 7.169C7.04667 6.389 6.103 5.99933 4.997 6Z" fill="#7398D5"/></svg></span>'
        : pet.gender === 'å¥³ã®å­' 
          ? '<span class="pet-card__gender female"><svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 16V14H2.5V13H4.5V9.977C3.222 9.83367 2.15233 9.288 1.291 8.34C0.430334 7.39133 0 6.27433 0 4.989C0 3.60033 0.486333 2.42167 1.459 1.453C2.431 0.484333 3.61133 0 5 0C6.38867 0 7.569 0.484333 8.541 1.453C9.513 2.42167 9.99933 3.60033 10 4.989C10 6.27433 9.56967 7.391 8.709 8.339C7.84767 9.28767 6.778 9.83367 5.5 9.977V13H7.5V14H5.5V16H4.5ZM5.003 9C6.109 9 7.05167 8.60933 7.831 7.828C8.61033 7.046 9 6.10233 9 4.997C9 3.89167 8.60933 2.949 7.828 2.169C7.04667 1.389 6.103 0.999333 4.997 1C3.891 1.00067 2.94833 1.39133 2.169 2.172C1.38967 2.954 1 3.89767 1 5.003C1 6.109 1.39067 7.05167 2.172 7.831C2.954 8.61033 3.89767 9 5.003 9Z" fill="#D55665"/></svg></span>'
          : '';
      
      return `
        <div class="pet-card" data-animal-type="${pet.animalType}">
          <a href="/search/${pet.animalType}s/${pet.classification === 'mix' ? 'mix/' : ''}${encodeURIComponent(breedTypeEn)}/${pet.id || pet.contentId}" class="pet-card__link">
            <div class="pet-card__inner">
              <div class="pet-card__image-container">
                <img
                  class="pet-card__image"
                  src="${imageUrl}"
                  alt="${pet.breedTypeJa}ã®å†™çœŸ"
                  loading="lazy"
                  width="600"
                  height="600"
                  onerror="this.src='/images/ui/img_loading-pet-image-01.webp'"
                />
              </div>
              <div class="pet-card__info">
                <h3 class="pet-card__title">
                  ${pet.breedTypeJa}
                  ${genderIcon}
                </h3>
                <div class="pet-card__details">
                  <p class="pet-card__detail-item">ã‚«ãƒ©ãƒ¼ï¼š${pet.color}</p>
                  <p class="pet-card__detail-item">èª•ç”Ÿæ—¥ï¼š${pet.birthday ? new Date(pet.birthday).toLocaleDateString('ja-JP', { year: 'numeric', month: 'numeric', day: 'numeric' }).replace(/\//g, '/') : 'æœªè¨­å®š'}</p>
                  <p class="pet-card__detail-item">åº—èˆ—ï¼š${pet.storeName}</p>
                </div>
              </div>
            </div>
          </a>
        </div>
      `;
    }

    // ãƒšãƒƒãƒˆè¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updatePetsDisplay(selectedTab) {
      const dataMap = { all: allStorePets, dog: storeDogs, cat: storeCats };
      const currentPets = dataMap[selectedTab] || [];

      if (petsGrid) {
        // DocumentFragmentã‚’ä½¿ç”¨ã—ã¦DOMã®æ›´æ–°ã‚’æœ€é©åŒ–
        const fragment = document.createDocumentFragment();
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = currentPets.map(generatePetCard).join('');
        
        while (tempDiv.firstChild) {
          fragment.appendChild(tempDiv.firstChild);
        }
        
        petsGrid.replaceChildren(fragment);
      }

      // ä»¶æ•°è¡¨ç¤ºã‚’æ›´æ–°
      const petsCountElement = document.getElementById('pets-count');
      if (petsCountElement) {
        const numberElement = petsCountElement.querySelector('.pets-count__number');
        if (numberElement) {
          numberElement.textContent = currentPets.length.toString();
        }
      }
    }

    // åˆæœŸè¡¨ç¤ºæ™‚ã«ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã«å¿œã˜ãŸãƒšãƒƒãƒˆã‚’è¡¨ç¤º
    const activeButton = document.querySelector('.pet-tabs__item--active');
    if (activeButton) {
      const initialTab = activeButton.dataset.tab || 'all';
      updatePetsDisplay(initialTab);
    }

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        if (button.classList.contains('pet-tabs__item--active')) return;
        
        // ã‚¹ãƒ†ãƒ¼ãƒˆæ›´æ–°ã‚’æœ€å°åŒ–
        tabButtons.forEach(btn => btn.classList.remove('pet-tabs__item--active'));
        button.classList.add('pet-tabs__item--active');

        const selectedTab = button.dataset.tab;
        updatePetsDisplay(selectedTab);
      });
    });
  });
</script>

<style lang="scss">
@use '../../styles/mixins' as *;
@use '../../styles/variables' as *;
@use '../../styles/tokens/typography' as *;

  .store-detail .pet-info__value .traffic-info {
    font-size: 0.9em;
    color: #666;
    margin-top: 0.25rem;
  }
  
  .phone-link {
    color: inherit;
    text-decoration: none;
  }
  
  .phone-link:hover {
    text-decoration: underline;
  }
  
  .business-hours {
    white-space: pre-line;
  }
  
  /* LINEãƒœã‚¿ãƒ³å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆBaseButton shortãƒ‡ã‚¶ã‚¤ãƒ³æº–æ‹ ï¼‰ */
  .line-button {
    display: inline-flex;
    align-items: center;
    border: 1px solid #00C300;
    border-radius: 4px;
    padding: rem(30) rem(75) rem(30) rem(55);
    text-decoration: none;
    color: #00C300;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
    min-width: rem(230);
    background-color: #fff;
    
    &:hover {
      text-decoration: none;
      
      .line-button__line {
        transform: translateX(rem(15));
      }
    }
  }
  
  .line-button__line {
    position: absolute;
    left: rem(-30);
    width: rem(40);
    height: 1px;
    background-color: #00C300;
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }
  
  .line-button__text {
    @include typography-ja-s($font-weight-semibold);
    color: #00C300;
    text-align: center;
    width: 100%;
    white-space: nowrap;
  }
  
  .line-button__icon {
    position: absolute;
    right: rem(30);
    top: 50%;
    transform: translateY(-50%);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: rem(20);
    height: rem(20);
    
    img {
      width: 100%;
      height: 100%;
    }
  }
  
  /* åº—èˆ—LINEé …ç›®ã®ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
  .pet-info__item--line {
    flex-direction: column;
    gap: rem(30);
    padding-bottom: rem(20);
    
    @include breakpoint-up(sm) {
      flex-direction: row;
      gap: initial;
    }
    
    .pet-info__label {
      align-self: flex-start;
      
      @include breakpoint-up(sm) {
        align-self: initial;
      }
    }
    
    .pet-info__value {
      display: flex;
      justify-content: center;
      
      @include breakpoint-up(sm) {
        display: initial;
        justify-content: initial;
      }
    }
  }
  
  /* Googleãƒãƒƒãƒ— */
  .pet-detail__map {
    width: 100%;
    margin-top: rem(40);
    
    @include breakpoint-up(sm) {
      margin-top: rem(60);
    }
  }
  
  .map-container {
    width: 100%;
    height: rem(360);
    border-radius: rem(8);
    overflow: hidden;
    
    > iframe {
      width: 100% !important;
      height: 100% !important;
      max-width: 100% !important;
      max-height: rem(360) !important;
      min-width: 100% !important;
      min-height: rem(360) !important;
      border: none !important;
      display: block !important;
    }
  }
  
  /* ã‚ˆã‚Šå¼·åŠ›ãªã‚»ãƒ¬ã‚¯ã‚¿ã§iframeã‚’å¯¾è±¡ */
  .pet-detail__map .map-container iframe {
    width: 100% !important;
    height: rem(360) !important;
    max-width: 100% !important;
    max-height: rem(360) !important;
    min-width: 100% !important;
    min-height: rem(360) !important;
    border: none !important;
    display: block !important;
  }
  
  /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨æ”¹è¡Œ */
  .mobile-break {
    @include breakpoint-up(sm) {
      display: none;
    }
  }
  
  .carousel__video-container {
    position: relative;
    width: 100%;
    height: 100%;
  }
  
  .carousel__video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: pointer;
  }
  
  .carousel__video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    cursor: pointer;
    z-index: 10;
  }
  
  .carousel__video-play-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: rem(80);
    height: rem(80);
    background-color: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 50%;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
    z-index: 10;
    pointer-events: none; // è£…é£¾ã®ã¿ã€ã‚¯ãƒªãƒƒã‚¯ä¸å¯
    
    @include breakpoint-up(lg) {
      width: rem(100);
      height: rem(100);
    }
    
    svg {
      margin-left: rem(4);
      width: rem(32);
      height: rem(32);
      
      @include breakpoint-up(lg) {
        width: rem(48);
        height: rem(48);
        margin-left: rem(6);
      }
    }
  }
  
  .carousel__video-container:hover .carousel__video-play-btn {
    background-color: rgba(0, 0, 0, 0.9);
    transform: translate(-50%, -50%) scale(1.1);
  }
  
  .carousel__thumbnail-video-element {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none; /* ã‚µãƒ ãƒã‚¤ãƒ«å‹•ç”»ã¯ã‚¯ãƒªãƒƒã‚¯ä¸å¯ */
    background-color: #f0f0f0; /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã®èƒŒæ™¯è‰² */
    border-radius: rem(4);
    
    @include breakpoint-up(md) {
      border-radius: rem(8);
    }
  }
  
  .carousel__video-fallback {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 1rem;
    border-radius: 8px;
  }
  
  .carousel__video-fallback a {
    color: #00C300;
    text-decoration: none;
  }
  
  .carousel__video-fallback a:hover {
    text-decoration: underline;
  }
  
  /* No pets section */
  .no-pets-section {
    padding: rem(40) 0;
    background: #f8f7f5;
    
    @include breakpoint-up(sm) {
      padding: rem(60) 0;
    }
  }
  
  .no-pets-message {
    text-align: center;
    max-width: rem(600);
    margin: 0 auto;
    padding: rem(20);
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    
    @include breakpoint-up(sm) {
      padding: rem(40);
    }
  }
  
  .no-pets-message p {
    margin: 0 0 rem(16) 0;
    color: #666;
    line-height: 1.6;
  }
  
  .no-pets-message p:last-child {
    margin: 0;
  }
  
  /* Loading animation for images */
  .carousel__image,
  .pet-card__image {
    transition: opacity 0.3s ease;
  }
  
  .carousel__image[style*="opacity: 0"],
  .pet-card__image[style*="opacity: 0"] {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }
  
  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒšãƒƒãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¨åŒã˜ï¼‰ */
  .media-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: none;
    
    &--active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }

  .media-modal__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    cursor: pointer;
  }

  .media-modal__content {
    position: relative;
    max-width: 95vw;
    max-height: 95vh;
    z-index: 1;
    border-radius: rem(8);
  }

  .media-modal__close {
    position: absolute;
    // ã™ã¹ã¦ã®ã‚µã‚¤ã‚ºã§å‹•ç”»å†…å´ã®å³ä¸Šã«é…ç½®
    top: rem(8);
    right: rem(8);
    width: rem(32);
    height: rem(32);
    background-color: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    z-index: 10; // å‹•ç”»ã®ä¸Šã«è¡¨ç¤º
    
    @include breakpoint-up(sm) {
      top: rem(12);
      right: rem(12);
      width: rem(36);
      height: rem(36);
    }
    
    @include breakpoint-up(lg) {
      top: rem(16);
      right: rem(16);
      width: rem(40);
      height: rem(40);
    }
    
    &:hover {
      background-color: rgba(255, 255, 255, 1);
      transform: scale(1.1);
    }
    
    svg {
      width: rem(16);
      height: rem(16);
      
      @include breakpoint-up(sm) {
        width: rem(18);
        height: rem(18);
      }
      
      @include breakpoint-up(lg) {
        width: rem(20);
        height: rem(20);
      }
    }
  }

  .media-modal__nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: rem(36);
    height: rem(36);
    border-radius: 50%;
    background-color: #fff;
    border: 1px solid #ccc;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 11;
    transition: all 0.3s ease;
    padding: 0;
    
    @include breakpoint-up(sm) {
      width: rem(40);
      height: rem(40);
    }
    
    @include breakpoint-up(lg) {
      width: rem(44);
      height: rem(44);
    }
    
    &:hover {
      background-color: #f8f9fa;
      color: #333;
    }
    
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      
      &:hover {
        background-color: #fff;
        color: #666;
      }
    }
    
    &--prev {
      left: rem(-10);
      
      @include breakpoint-up(sm) {
        left: rem(-20);
      }
    }
    
    &--next {
      right: rem(-10);
      
      @include breakpoint-up(sm) {
        right: rem(-20);
      }
    }
    
    svg {
      width: 24px;
      height: 24px;
    }
  }

  .media-modal__media {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .media-modal__image {
    // æ¨ª4:ç¸¦3ã®å›ºå®šæ¯”ç‡ã§ç”»é¢å†…æœ€å¤§ã‚µã‚¤ã‚ºè¡¨ç¤º
    aspect-ratio: 4 / 3 !important; // æ¨ª4:ç¸¦3ã‚’å¼·åˆ¶é©ç”¨
    object-fit: cover; // ç”»åƒã‚’ãƒ•ãƒ¬ãƒ¼ãƒ å†…ã§ãƒˆãƒªãƒŸãƒ³ã‚°è¡¨ç¤º
    border-radius: rem(8);
    height: auto !important; // heightã‚’è‡ªå‹•è¨ˆç®—ã«å¼·åˆ¶
    
    // aspect-ratioã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚widthã®ã¿æŒ‡å®š
    width: min(90vw, 67.5vh);
    max-width: 90vw;
    max-height: 90vh;
    
    @include breakpoint-up(sm) {
      width: min(85vw, 63.75vh);
      max-width: 85vw;
      max-height: 85vh;
    }
    
    @include breakpoint-up(md) {
      width: min(70vw, 56.25vh);
      max-width: 70vw;
      max-height: 75vh;
    }
    
    @include breakpoint-up(lg) {
      width: min(80vw, 60vh);
      max-width: 80vw;
      max-height: 80vh;
    }
  }

  .media-modal__video {
    border: none;
    border-radius: rem(8);
    display: block;
    object-fit: cover; // é»’ã„ä½™ç™½ã‚’å®Œå…¨ã«é™¤å»
    
    // æ¨ª4:ç¸¦3ã®å›ºå®šæ¯”ç‡ã§ç”»é¢å†…æœ€å¤§ã‚µã‚¤ã‚ºè¡¨ç¤º
    aspect-ratio: 4 / 3 !important; // æ¨ª4:ç¸¦3ã‚’å¼·åˆ¶é©ç”¨
    height: auto !important; // heightã‚’è‡ªå‹•è¨ˆç®—ã«å¼·åˆ¶
    
    // aspect-ratioã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚widthã®ã¿æŒ‡å®š
    width: min(90vw, 67.5vh);
    max-width: 90vw;
    max-height: 90vh;
    
    @include breakpoint-up(sm) {
      width: min(85vw, 63.75vh);
      max-width: 85vw;
      max-height: 85vh;
    }
    
    @include breakpoint-up(md) {
      width: min(70vw, 56.25vh);
      max-width: 70vw;
      max-height: 75vh;
    }
    
    @include breakpoint-up(lg) {
      width: min(80vw, 60vh);
      max-width: 80vw;
      max-height: 80vh;
    }
  }

  /* åº—èˆ—è©³ç´°ãƒšãƒ¼ã‚¸å°‚ç”¨ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ©ã‚¹ */
  .store-modal-image,
  .store-modal-video {
    aspect-ratio: 4 / 3 !important;
    height: auto !important;
    object-fit: cover !important;
    border-radius: rem(8) !important;
    width: min(90vw, 67.5vh) !important;
    max-width: 90vw !important;
    max-height: 90vh !important;
  }

  /* ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
  .carousel__image--clickable:hover,
  .carousel__video-container--clickable:hover {
    transform: scale(1.02);
    transition: transform 0.3s ease;
  }

  .carousel__image--clickable:hover::after,
  .carousel__video-container--clickable:hover::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.1);
    pointer-events: none;
  }
</style>
</Layout>