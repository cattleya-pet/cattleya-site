---
import phoneIcon from '../../assets/icons/icon_store-phone-01.svg';
import lineIcon from '../../assets/icons/icon_line-01.svg';
import mailIcon from '../../assets/icons/icon_store-mail-01.svg';
import { getAllStores } from '../../lib/api/stores/queries';
import './MobileCTAButtons.scss';

// 全店舗情報を取得（APIの生の順番を維持）
const stores = await getAllStores();

console.log('店舗情報（API順）:', stores.map(store => ({ 
  name: store.storeName, 
  line: store.storeLine 
})));
---

<!-- sm未満時のみ表示される画面最下端のCTAボタン群 -->
<div class="mobile-cta-buttons">
  <!-- トリガーバー -->
  <button class="mobile-cta-trigger" id="mobile-cta-trigger">
    <span class="mobile-cta-trigger__icon"></span>
    <span class="mobile-cta-trigger__text">お問い合わせはこちら</span>
  </button>

  <!-- CTAボタン群（初期状態では非表示） -->
  <div class="mobile-cta-content" id="mobile-cta-content">
    <!-- 上段：最初の2店舗のボタン（電話・LINE） -->
    <div class="mobile-cta-row">
      {stores.slice(0, 2).map((store) => (
        <>
          <a href={`tel:${store.storePhoneNumber}`} class="mobile-cta-button">
            <div class="mobile-cta-button__icon">
              <img src={phoneIcon.src} alt="電話アイコン" />
            </div>
            <div class="mobile-cta-button__text">{store.storeName}TEL</div>
          </a>
          
          <a href={store.storeLine ? `https://lin.ee/${store.storeLine}` : '#'} target="_blank" rel="noopener noreferrer" class="mobile-cta-button">
            <div class="mobile-cta-button__icon">
              <img src={lineIcon.src} alt="LINEアイコン" />
            </div>
            <div class="mobile-cta-button__text">{store.storeName}LINE</div>
          </a>
        </>
      ))}
    </div>

    <!-- 下段：3番目の店舗のボタンとメールボタン -->
    <div class="mobile-cta-row">
      {stores[2] && (
        <>
          <a href={`tel:${stores[2].storePhoneNumber}`} class="mobile-cta-button">
            <div class="mobile-cta-button__icon">
              <img src={phoneIcon.src} alt="電話アイコン" />
            </div>
            <div class="mobile-cta-button__text">{stores[2].storeName}TEL</div>
          </a>
          
          <a href={stores[2].storeLine ? `https://lin.ee/${stores[2].storeLine}` : '#'} target="_blank" rel="noopener noreferrer" class="mobile-cta-button">
            <div class="mobile-cta-button__icon">
              <img src={lineIcon.src} alt="LINEアイコン" />
            </div>
            <div class="mobile-cta-button__text">{stores[2].storeName}LINE</div>
          </a>
        </>
      )}
      
      <a href="/contact#mail-contact" class="mobile-cta-button mobile-cta-button--half">
        <div class="mobile-cta-button__icon">
          <img src={mailIcon.src} alt="メールアイコン" />
        </div>
        <div class="mobile-cta-button__text">問い合わせフォーム</div>
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const trigger = document.getElementById('mobile-cta-trigger');
    const content = document.getElementById('mobile-cta-content');
    
    if (trigger && content) {
      trigger.addEventListener('click', () => {
        const isOpen = content.classList.contains('mobile-cta-content--open');
        
        if (isOpen) {
          // 閉じる
          content.classList.remove('mobile-cta-content--open');
          trigger.classList.remove('mobile-cta-trigger--open');
        } else {
          // 開く
          content.classList.add('mobile-cta-content--open');
          trigger.classList.add('mobile-cta-trigger--open');
        }
      });
    }
  });
</script>